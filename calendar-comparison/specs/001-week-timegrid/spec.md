# Feature Specification: 週間タイムグリッド描画 (Week Time Grid Display)

**Feature Branch**: `001-week-timegrid`
**Created**: 2026-02-14
**Status**: Draft
**Input**: User description: "週間タイムグリッド描画 (F1)"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - View Weekly Calendar Structure (Priority: P1)

開発者が週間バーチカルカレンダーの基本構造を表示し、7日分のタイムグリッドが正しく描画されることを確認できる。

**Why this priority**: これは週間カレンダービューの基盤となる機能であり、他のすべての機能（イベント配置、ドラッグ&ドロップ等）がこの上に構築される。この機能なしでは何も実装できない。

**Independent Test**: ブラウザでアプリケーションを開いたときに、7日分の列と24時間分の時間グリッドが表示されることで完全にテスト可能。イベントデータが存在しなくてもグリッド構造のみで価値を提供する。

**Acceptance Scenarios**:

1. **Given** アプリケーションが起動された状態, **When** ユーザーが週間ビューを開く, **Then** 当週の月曜日から日曜日までの7日分のカラムが横に並んで表示される
2. **Given** 週間グリッドが表示されている状態, **When** ユーザーがヘッダーを確認する, **Then** 各日の曜日と日付（例: "月 2/17"）が上部に表示される
3. **Given** 週間グリッドが表示されている状態, **When** ユーザーが左端を確認する, **Then** 0:00から23:00までの時間ラベルが1時間刻みで表示される
4. **Given** 週間グリッドが表示されている状態, **When** ユーザーがグリッド線を確認する, **Then** 1時間ごとの水平線と各日の間の垂直線が描画されている

---

### User Story 2 - Navigate Through Time Range (Priority: P2)

ユーザーが24時間の時間範囲を縦スクロールで閲覧し、必要な時間帯にすばやくアクセスできる。

**Why this priority**: 24時間分のグリッド（1440px）は画面に収まらないため、スクロール機能とデフォルトの表示位置が UX に直結する。グリッド構造だけでは実用的でない。

**Independent Test**: ページ読み込み時に 8:00 付近が表示され、縦スクロールで 0:00〜24:00 の全範囲にアクセスできることで検証可能。

**Acceptance Scenarios**:

1. **Given** 週間グリッドが初回表示された状態, **When** ユーザーがビューを確認する, **Then** スクロール位置が 8:00 付近に自動的に設定されている
2. **Given** 週間グリッドが表示されている状態, **When** ユーザーが下方向にスクロールする, **Then** 夕方から深夜の時間帯（18:00〜24:00）が表示される
3. **Given** 週間グリッドが表示されている状態, **When** ユーザーが上方向にスクロールする, **Then** 早朝の時間帯（0:00〜7:00）が表示される

---

### User Story 3 - Identify Current Day Visually (Priority: P3)

ユーザーが今日の日付列を視覚的に識別し、現在の時間帯を素早く見つけられる。

**Why this priority**: 今日の列のハイライトは UX の向上に寄与するが、グリッドの基本機能は損なわれない。最後に実装しても問題ない。

**Independent Test**: 今日の日付に該当する列の背景色がわずかに異なることを確認することで検証可能。

**Acceptance Scenarios**:

1. **Given** 今日が2026年2月17日（月曜日）である状態, **When** ユーザーが週間グリッドを表示する, **Then** 月曜日の列の背景がわずかにハイライトされる
2. **Given** 今日が週の範囲外（先週または来週）の状態, **When** ユーザーが週間グリッドを表示する, **Then** どの列もハイライトされない

---

### Edge Cases

- 今日の日付が週の範囲外（先週または来週）の場合、ハイライト表示は行われない
- ブラウザの幅が狭い場合でも、7列の最小幅は維持され、横スクロールで対応する（レスポンシブ対応はスコープ外）
- グリッドの高さ（1440px）がビューポートを超える場合、縦スクロールバーが表示される

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは当週の月曜日から日曜日までの7日間を週間ビューとして表示しなければならない
- **FR-002**: システムは各日のヘッダーに曜日と日付（例: "月 2/17"）を表示しなければならない
- **FR-003**: システムは左端に 0:00〜23:00 までの時間ラベルを1時間刻みで表示しなければならない
- **FR-004**: システムは1時間ごとに水平線を描画しなければならない
- **FR-005**: システムは各日の列の間に垂直線を描画しなければならない
- **FR-006**: システムは1時間を 60px として描画しなければならない（合計高さ 1440px、定数 `HOUR_HEIGHT` で変更可能）
- **FR-007**: システムは縦スクロール可能なコンテナを提供しなければならない
- **FR-008**: システムは初回表示時にスクロール位置を 8:00 付近（480px付近）に設定しなければならない
- **FR-009**: システムは今日に該当する日付列の背景をわずかにハイライト表示しなければならない
- **FR-010**: システムは absolute 方式と Grid 方式の2パターンで実装しなければならない

### Implementation Constraints (from Constitution)

- **IC-001**: absolute 方式では、7つの `position: relative` コンテナを `flex` で横並びにする
- **IC-002**: Grid 方式では、全体を1つの Grid（rows × columns）で定義する
- **IC-003**: 両方式で共通のヘッダーコンポーネント（WeekHeader）と時間ラベルコンポーネント（TimeLabels）を使用する
- **IC-004**: 日付操作には `date-fns` ライブラリを使用する
- **IC-005**: スタイリングには CSS Modules を使用する（CSS-in-JS は禁止）

### Key Entities *(include if feature involves data)*

- **DayColumn**: 1日分のカラムを表現する論理単位。日付（ISO 8601形式）、曜日、列インデックス（0-6）を持つ
- **TimeSlot**: 1時間単位の時間スロット。時刻（0-23）、縦位置（ピクセル）を持つ
- **ViewportState**: スクロール位置とビューポートの高さを管理する状態

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: ユーザーは週間グリッドを表示したときに、1秒以内に7日分の列と24時間分のグリッド線を確認できる
- **SC-002**: ユーザーは初回表示時に、スクロール操作なしで 7:00〜12:00 の時間帯が表示される（8:00 を中心とした範囲）
- **SC-003**: ユーザーは縦スクロールにより、0:00〜24:00 の全時間帯にアクセスできる
- **SC-004**: 今日の日付列が視覚的に識別可能であり、他の列との区別が明確である
- **SC-005**: absolute 方式と Grid 方式で同一の見た目と動作を提供する（視覚的な差異がない）

## Assumptions

1. 週の開始は月曜日とする（日曜日スタートではない）
2. 時刻表示は24時間表記とする（AM/PM 表記は使用しない）
3. タイムゾーンはブラウザのローカルタイムゾーンを使用する
4. 最小表示幅は 1024px 以上を想定する（レスポンシブ対応はスコープ外）
5. 1時間の高さ（HOUR_HEIGHT）は 60px を基本値とするが、定数として変更可能にする
6. 今日のハイライト色は背景色の微調整（例: 5% 明度変更）とする

## Out of Scope

- 週の切り替えナビゲーション（前週・次週ボタン）
- 月ビュー・年ビューへの切り替え
- 時間表示フォーマットのカスタマイズ（12時間表記への変更等）
- グリッド線のスタイルカスタマイズ（色・太さの変更 UI）
- HOUR_HEIGHT のリアルタイム変更 UI（定数として変更可能だが UI は提供しない）
- ダークモードの実装
- アクセシビリティ対応（ARIA 属性等）

## Dependencies

- `date-fns` ライブラリ（日付操作用）
- React 19.x（関数コンポーネント + Hooks）
- TypeScript strict mode
- CSS Modules サポート（Vite で標準サポート）

## Notes

- この機能は週間カレンダービューの基盤であり、F2（イベント配置）以降の機能はこの上に構築される
- absolute 方式と Grid 方式の実装比較が目的であるため、両方式で完全に同一の見た目と動作を提供する必要がある
- side-by-side モードで両方式を並べて表示し、視覚的な差異がないことを確認する
